# ç‰ˆæœ¬æ›´æ–°æ“ä½œæ¸…å• (Configç±»ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†)

## ğŸ¯ æ¶æ„é‡æ„è¯´æ˜

**é—®é¢˜**: ç‰ˆæœ¬å·åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼ˆversion.txtã€update_config.jsonç­‰ï¼‰ï¼Œæ›´æ–°æ—¶éœ€è¦æ‰‹åŠ¨åŒæ­¥å¤šä¸ªåœ°æ–¹ï¼Œè¿åäº†DRYåŸåˆ™ã€‚

**è§£å†³æ–¹æ¡ˆ**: é‡‡ç”¨Configç±»ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†æ¶æ„ï¼Œå®ç°é…ç½®æ–‡ä»¶é©±åŠ¨çš„ç‰ˆæœ¬æ§åˆ¶ï¼ˆSingle Source of Truthï¼‰ã€‚

### ğŸ”„ é‡æ„å†…å®¹

- [x] `auto_updater/config.py` - é›†æˆç‰ˆæœ¬ç®¡ç†åŠŸèƒ½åˆ°Configç±»
- [x] `auto_updater/__init__.py` - ç§»é™¤version_managerä¾èµ–ï¼Œä½¿ç”¨Configç±»
- [x] `updater_config.json` - å”¯ä¸€ç‰ˆæœ¬æ•°æ®æºï¼ˆversion.currentå­—æ®µï¼‰
- [x] `update_state.json` - æ–°å¢çŠ¶æ€ç®¡ç†æ–‡ä»¶ï¼Œæ›¿æ¢update_config.json
- [x] åˆ é™¤ `version_manager.py` - åŠŸèƒ½å·²åˆå¹¶åˆ°Configç±»
- [x] åˆ é™¤ `version.txt` - ç‰ˆæœ¬ä¿¡æ¯ç›´æ¥å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­

## ğŸš€ ç‰ˆæœ¬æ›´æ–°æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨Configç±»APIï¼ˆæ¨èï¼‰

```python
from auto_updater.config import get_config

# è·å–é…ç½®å®ä¾‹
config = get_config()

# æ›´æ–°ç‰ˆæœ¬å·ï¼ˆè‡ªåŠ¨ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ï¼‰
success = config.update_current_version("2.1.0")

# éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§
current_version = config.current_version
is_newer = config.is_newer_version("v2.2.0", current_version)
```

### æ–¹æ³•2: ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `updater_config.json`:
```json
{
  "version": {
    "current": "2.1.0",  // ä¿®æ”¹è¿™é‡Œ
    "check_interval_days": 30,
    "auto_check_enabled": true
  }
}
```

### æ–¹æ³•3: ä½¿ç”¨Pythonè„šæœ¬ï¼ˆå¯åˆ›å»ºå·¥å…·è„šæœ¬ï¼‰

```python
# update_version.py
from auto_updater.config import get_config
import sys

def update_version(new_version):
    config = get_config()
    if config.update_current_version(new_version):
        print(f"ç‰ˆæœ¬å·²æ›´æ–°åˆ°: {new_version}")
        return True
    else:
        print("ç‰ˆæœ¬æ›´æ–°å¤±è´¥")
        return False

if __name__ == "__main__":
    if len(sys.argv) == 2:
        update_version(sys.argv[1])
    else:
        print("ç”¨æ³•: python update_version.py x.x.x")
```

## ğŸ“‹ Configç±»ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½

### æ ¸å¿ƒæ–¹æ³•

```python
from auto_updater.config import get_config

config = get_config()

# è·å–å½“å‰ç‰ˆæœ¬
version = config.current_version  # "2.0.0"

# æ›´æ–°ç‰ˆæœ¬
success = config.update_current_version("2.1.0")

# ç‰ˆæœ¬æ¯”è¾ƒ
result = config.compare_versions("2.0.0", "2.1.0")  # -1
is_newer = config.is_newer_version("v2.1.0", "2.0.0")  # True

# æ›´æ–°æ£€æŸ¥æ—¶é—´ç®¡ç†
config.update_last_check_time()
should_check = config.should_check_for_updates()

# è·å–GitHubä¿¡æ¯
github_url = config.github_latest_release_url
```

### è‡ªåŠ¨çŠ¶æ€ç®¡ç†

- **ç‰ˆæœ¬çŠ¶æ€**: å­˜å‚¨åœ¨ `updater_config.json` çš„ `version.current` å­—æ®µ
- **æ›´æ–°æ£€æŸ¥çŠ¶æ€**: å­˜å‚¨åœ¨ `update_state.json` æ–‡ä»¶ä¸­
- **è‡ªåŠ¨åŒæ­¥**: ç‰ˆæœ¬æ›´æ–°æ—¶è‡ªåŠ¨ä¿å­˜åˆ°é…ç½®æ–‡ä»¶
- **éªŒè¯æœºåˆ¶**: å†…ç½®ç‰ˆæœ¬å·æ ¼å¼éªŒè¯å’Œæ¯”è¾ƒé€»è¾‘

## âœ… é…ç½®æ–‡ä»¶ç»“æ„

### `updater_config.json` (ä¸»é…ç½®æ–‡ä»¶)

```json
{
  "app": {
    "name": "PDFé‡å‘½åå·¥å…·",
    "executable": "PDF_Rename_Operation.exe"
  },
  "repository": {
    "owner": "chen-huai",
    "repo": "Temu_PDF_Rename_APP",
    "api_base": "https://api.github.com"
  },
  "version": {
    "current": "2.0.0",              // ã€å”¯ä¸€ç‰ˆæœ¬æ•°æ®æºã€‘
    "check_interval_days": 30,
    "auto_check_enabled": true
  },
  "update": {
    "backup_count": 3,
    "download_timeout": 300,
    "max_retries": 3,
    "auto_restart": true
  },
  "network": {
    "request_headers": {
      "Accept": "application/vnd.github.v3+json",
      "User-Agent": "App-Updater/1.0"
    }
  }
}
```

### `update_state.json` (çŠ¶æ€æ–‡ä»¶)

```json
{
  "last_check_date": "2025-10-27T10:30:00",
  "last_download_version": "2.0.0",
  "update_history": [
    {
      "date": "2025-10-27T10:30:00",
      "from_version": "1.9.0",
      "to_version": "2.0.0",
      "success": true
    }
  ]
}
```

## ğŸ“‹ æ›´æ–°éªŒè¯æ¸…å•

### è‡ªåŠ¨éªŒè¯
```python
from auto_updater.config import get_config

config = get_config()

# éªŒè¯ç‰ˆæœ¬æ ¼å¼
print(f"å½“å‰ç‰ˆæœ¬: {config.current_version}")

# éªŒè¯GitHubè¿æ¥
print(f"GitHub URL: {config.github_latest_release_url}")

# éªŒè¯é…ç½®å®Œæ•´æ€§
print(f"æ£€æŸ¥é—´éš”: {config.update_check_interval_days}å¤©")
```

### æ‰‹åŠ¨éªŒè¯
- [ ] `updater_config.json` ä¸­çš„ç‰ˆæœ¬å·æ­£ç¡®
- [ ] Configç±»èƒ½æ­£ç¡®è¯»å–ç‰ˆæœ¬å·
- [ ] ç‰ˆæœ¬æ¯”è¾ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ›´æ–°æ£€æŸ¥çŠ¶æ€ç®¡ç†æ­£å¸¸
- [ ] GitHub APIè¿æ¥æ­£å¸¸

## ğŸ¨ æ¶æ„ä¼˜åŠ¿

### âœ… éµå¾ªè®¾è®¡åŸåˆ™
- **DRY**: ç‰ˆæœ¬å·åªåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰
- **KISS**: æ›´æ–°ç‰ˆæœ¬åªéœ€ä¿®æ”¹ä¸€ä¸ªé…ç½®å­—æ®µ
- **å•ä¸€èŒè´£**: Configç±»ä¸“é—¨è´Ÿè´£é…ç½®å’Œç‰ˆæœ¬ç®¡ç†
- **é…ç½®é©±åŠ¨**: æ‰€æœ‰åŠŸèƒ½é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶

### âœ… å¼€å‘ä½“éªŒ
- **é›¶é”™è¯¯**: é¿å…æ‰‹åŠ¨åŒæ­¥å¯¼è‡´çš„ç‰ˆæœ¬ä¸ä¸€è‡´
- **é«˜æ•ˆç‡**: ä¸€å¤„ä¿®æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆ
- **å¯éªŒè¯**: å†…ç½®ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥
- **æ˜“ç»´æŠ¤**: é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®å’Œç‰ˆæœ¬ä¿¡æ¯

### âœ… æ¨¡å—ç‹¬ç«‹æ€§
- **è‡ªåŒ…å«**: auto_updateræ¨¡å—å®Œå…¨ç‹¬ç«‹
- **å¯ç§»æ¤**: æ˜“äºå¤åˆ¶åˆ°å…¶ä»–é¡¹ç›®
- **é…ç½®åŒ–**: é€šè¿‡é…ç½®æ–‡ä»¶é€‚é…ä¸åŒé¡¹ç›®

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### ğŸš« ä¸è¦æ‰‹åŠ¨ä¿®æ”¹
- ä¸è¦åˆ›å»ºç‹¬ç«‹çš„version.txtæ–‡ä»¶
- ä¸è¦ç»•è¿‡Configç±»ç›´æ¥æ“ä½œç‰ˆæœ¬ä¿¡æ¯
- ä¸è¦åœ¨å¤šä¸ªåœ°æ–¹ç»´æŠ¤ç‰ˆæœ¬å·

### âœ… æ­£ç¡®çš„æ›´æ–°æµç¨‹
1. ä¿®æ”¹ `updater_config.json` ä¸­çš„ `version.current` å­—æ®µ
2. æˆ–ä½¿ç”¨Configç±»APIæ›´æ–°ç‰ˆæœ¬
3. éªŒè¯ç‰ˆæœ¬æ›´æ–°æ˜¯å¦ç”Ÿæ•ˆ
4. æµ‹è¯•åº”ç”¨ç¨‹åºåŠŸèƒ½
5. æäº¤ä»£ç å¹¶åˆ›å»ºGitHub Release

### ğŸ“ å¼€å‘è€…æ³¨æ„
- ç‰ˆæœ¬å·æ ¼å¼: `x.y.z`ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰
- æ–°åŠŸèƒ½: é€’å¢æ¬¡ç‰ˆæœ¬å· (y)
- Bugä¿®å¤: é€’å¢ä¿®è®¢ç‰ˆæœ¬å· (z)
- é‡å¤§å˜æ›´: é€’å¢ä¸»ç‰ˆæœ¬å· (x)
- GitHub Releaseæ ‡ç­¾æ ¼å¼: `vx.y.z`

## ğŸ”„ Gitå·¥ä½œæµ

```bash
# 1. æ›´æ–°ç‰ˆæœ¬ï¼ˆæ–¹æ³•1ï¼šç›´æ¥ä¿®æ”¹é…ç½®ï¼‰
# ç¼–è¾‘ updater_config.jsonï¼Œä¿®æ”¹ version.current

# æˆ–æ–¹æ³•2ï¼šä½¿ç”¨Pythonè„šæœ¬
python -c "
from auto_updater.config import get_config
config = get_config()
config.update_current_version('2.1.0')
print('ç‰ˆæœ¬å·²æ›´æ–°')
"

# 2. éªŒè¯åŠŸèƒ½
python PDF_Rename_Operation.py

# 3. æäº¤æ›´æ”¹
git add .
git commit -m "chore: å‡çº§ç‰ˆæœ¬åˆ° v2.1.0"

# 4. åˆ›å»ºæ ‡ç­¾
git tag v2.1.0
git push origin v2.1.0

# 5. åˆ›å»ºGitHub Releaseå¹¶ä¸Šä¼ æ–°ç‰ˆæœ¬
```

## ğŸ”§ é›†æˆåˆ°åº”ç”¨ç¨‹åº

### åœ¨ä¸»ç¨‹åºä¸­ä½¿ç”¨

```python
from auto_updater.config import get_config

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.config = get_config()
        self.setup_ui()
        self.update_version_display()

    def update_version_display(self):
        # åŠ¨æ€æ˜¾ç¤ºç‰ˆæœ¬å·
        version_text = f"Version v{self.config.current_version}"
        self.version_label.setText(version_text)
        self.setWindowTitle(f"PDFé‡å‘½åå·¥å…· v{self.config.current_version}")
```

### åœ¨è‡ªåŠ¨æ›´æ–°å™¨ä¸­ä½¿ç”¨

```python
from auto_updater import AutoUpdater
from auto_updater.config import get_config

def check_and_update():
    config = get_config()

    # æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°
    if config.should_check_for_updates():
        updater = AutoUpdater()
        if updater.check_for_updates():
            updater.execute_update()

        # æ›´æ–°æ£€æŸ¥æ—¶é—´
        config.update_last_check_time()
```

---

**é‡æ„å®Œæˆ**: 2025-10-27
**æ¶æ„è®¾è®¡**: Configç±»ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†
**ç»´æŠ¤æˆæœ¬**: æä½ï¼ˆé…ç½®æ–‡ä»¶é©±åŠ¨ï¼‰
**é”™è¯¯é£é™©**: æä½ï¼ˆå•ä¸€æ•°æ®æºï¼‰
**æ¨¡å—ç‹¬ç«‹æ€§**: å®Œå…¨è‡ªåŒ…å«ï¼Œæ˜“äºç§»æ¤