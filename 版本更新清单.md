# 版本更新操作清单 (统一版本管理架构)

## 🎯 架构重构说明

**问题**: 版本号分散在多个文件中，更新时需要手动同步多个地方，违反了DRY原则。

**解决方案**: 实现统一版本管理架构（Single Source of Truth）。

### 📁 新增文件

- [x] `version_manager.py` - 统一版本管理器（单一数据源）
- [x] `update_version.py` - 版本更新工具脚本
- [x] `版本更新清单.md` - 本文档

### 🔄 重构内容

- [x] `PDF_Rename_Operation.py` - 集成版本管理器，使用动态版本显示
- [x] `version.txt` - 由版本管理器自动同步
- [x] 菜单版本显示 - 动态设置，无需修改UI文件

## 🚀 版本更新方法

### 方法1: 使用自动化脚本（推荐）

```bash
# 更新到新版本
python update_version.py 2.1.0

# 验证版本一致性
python update_version.py --verify

# 同步所有版本文件
python update_version.py --sync
```

### 方法2: 手动更新（仅限开发）

1. **唯一修改点**: `version_manager.py` 第25行
   ```python
   CURRENT_VERSION = "2.1.0"  # 只需要修改这里
   ```

2. **运行同步脚本**:
   ```bash
   python update_version.py --sync
   ```

## 📋 版本管理器功能

### `version_manager.py` 核心功能

- **单一数据源**: 所有版本信息从`CURRENT_VERSION`常量获取
- **自动同步**: 自动同步`version.txt`文件
- **动态显示**: 提供UI显示所需的格式化文本
- **配置同步**: 自动更新相关配置文件
- **验证机制**: 内置版本号格式验证

### API接口

```python
from version_manager import get_version, get_version_display_text, update_app_version

# 获取版本号
version = get_version()  # "2.0.0"

# 获取显示文本
display_text = get_version_display_text()  # "Version v2.0.0"

# 更新版本（唯一入口）
update_app_version("2.1.0")  # 自动更新所有相关文件
```

## ✅ 自动更新内容

当使用`update_app_version()`时，以下内容会自动同步：

### 🔄 核心文件
- [x] `version_manager.py` - 版本常量
- [x] `PDF_Rename_Operation.py` - 主程序版本引用
- [x] `version.txt` - 版本文件

### 🔄 配置文件
- [x] `update_config.json` - 更新器配置（如果存在）

### 🔄 UI显示
- [x] 菜单栏版本文本 - 动态设置
- [x] 关于对话框标题 - 动态获取
- [x] 关于对话框版本显示 - 动态获取

## 📋 更新验证清单

### 自动验证
```bash
python update_version.py --verify
```

### 手动验证
- [ ] 主程序启动正常
- [ ] 菜单栏显示 "Version v2.0.0"
- [ ] 关于对话框标题包含版本号
- [ ] 关于对话框版本信息正确
- [ ] 更新检查功能正常
- [ ] `version.txt`内容正确
- [ ] 所有配置文件版本一致

## 🎨 架构优势

### ✅ 遵循设计原则
- **DRY**: 版本号只在一个地方定义
- **KISS**: 更新版本只需一个命令
- **单一职责**: 版本管理器专门负责版本控制
- **自动化**: 最大限度减少手动操作

### ✅ 开发体验
- **零错误**: 避免手动同步导致的版本不一致
- **高效率**: 一键更新所有相关文件
- **可验证**: 内置版本一致性检查
- **易维护**: 集中管理所有版本相关逻辑

## ⚠️ 重要注意事项

### 🚫 不要手动修改
- 不要直接修改 `PDF_Rename_Operation.py` 中的版本引用
- 不要直接修改 `version.txt` 文件
- 不要手动修改UI文件的版本文本

### ✅ 正确的更新流程
1. 使用 `python update_version.py x.x.x` 更新版本
2. 运行 `python update_version.py --verify` 验证一致性
3. 测试应用程序功能
4. 提交代码并创建GitHub Release

### 📝 开发者注意
- 版本号格式: `x.y.z`（语义化版本）
- 新功能: 递增次版本号 (y)
- Bug修复: 递增修订版本号 (z)
- 重大变更: 递增主版本号 (x)

## 🔄 Git工作流

```bash
# 1. 更新版本
python update_version.py 2.1.0

# 2. 验证功能
python PDF_Rename_Operation.py

# 3. 提交更改
git add .
git commit -m "chore: 升级版本到 v2.1.0"

# 4. 创建标签
git tag v2.1.0
git push origin v2.1.0

# 5. 创建GitHub Release并上传新版本
```

---

**重构完成**: 2025-10-17
**架构设计**: 单一数据源版本管理
**维护成本**: 极低（一键更新）
**错误风险**: 极低（自动化同步）