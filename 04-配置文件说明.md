# 配置文件说明

## 概述

项目使用统一的配置文件管理系统，主要配置文件位于项目根目录。

## 配置文件清单

### 1. updater_config.json（主配置文件）
**位置**：`项目根目录/updater_config.json`

**用途**：自动更新功能的主要配置文件，包含应用信息、仓库配置、版本管理、更新设置等。

**主要内容**：
```json
{
  "app": {
    "name": "PDF重命名工具",                    // 应用名称
    "executable": "PDF_Rename_Operation.exe",    // 可执行文件名
    "version_file": "version.txt"                // 版本信息文件
  },
  "repository": {
    "owner": "chen-huai",                        // GitHub用户名
    "repo": "Temu_PDF_Rename_APP",               // 仓库名称
    "api_base": "https://api.github.com"          // GitHub API地址
  },
  "version": {
    "current": "2.0.0",                          // 当前版本号
    "check_interval_days": 30,                   // 检查间隔（天）
    "auto_check_enabled": true                   // 是否启用自动检查
  },
  "update": {
    "backup_count": 3,                           // 保留备份数量
    "download_timeout": 300,                     // 下载超时（秒）
    "max_retries": 3,                           // 最大重试次数
    "auto_restart": true                        // 是否自动重启
  },
  "network": {
    "request_headers": {
      "Accept": "application/vnd.github.v3+json",
      "User-Agent": "PDF-Rename-Tool-Updater/1.0"
    }
  }
}
```

### 2. version.txt（版本信息文件）
**位置**：`项目根目录/version.txt` 和 `auto_updater/version.txt`

**用途**：存储当前应用程序的版本号，确保版本信息的一致性。

**格式**：
```
2.0.0
```

**要求**：
- 仅包含版本号，一行一个
- 版本号格式：x.y.z（如2.0.0）
- 两个version.txt文件内容必须保持一致

### 3. auto_updater/update_config.json（更新状态配置）
**位置**：`auto_updater/update_config.json`

**用途**：记录更新功能的状态信息，如最后检查时间等。

**主要内容**：
```json
{
  "last_check_date": "2025-10-24T17:24:57.017016"  // 最后检查时间
}
```

**特点**：
- 自动维护，无需手动修改
- 记录更新检查的历史信息
- 用于控制检查频率

## 配置文件管理

### 版本号同步
为确保版本号一致性，请使用以下工具：

```bash
# 更新版本号
python update_version.py 2.1.0

# 验证版本一致性
python update_version.py --verify
```

### 配置文件修改注意事项

1. **updater_config.json**：
   - 修改仓库信息时需确保GitHub仓库存在
   - 版本号修改需要同步更新version.txt
   - 网络配置一般不需要修改

2. **version.txt**：
   - 使用版本管理工具修改，避免手动编辑
   - 确保两个文件内容一致
   - 版本号必须符合语义化版本规范

3. **auto_updater/update_config.json**：
   - 由程序自动维护，无需手动修改
   - 如需重置检查时间，可删除该文件

## 配置验证

### 检查配置完整性
```bash
# 运行配置检查脚本
python -c "
import json
import os

# 检查主配置文件
try:
    with open('updater_config.json', 'r', encoding='utf-8') as f:
        config = json.load(f)
    print('✓ updater_config.json 格式正确')
except Exception as e:
    print(f'✗ updater_config.json 错误: {e}')

# 检查版本文件
try:
    with open('version.txt', 'r') as f:
        version = f.read().strip()
    print(f'✓ version.txt 版本: {version}')
except Exception as e:
    print(f'✗ version.txt 错误: {e}')

# 检查版本一致性
try:
    with open('auto_updater/version.txt', 'r') as f:
        auto_version = f.read().strip()
    if version == auto_version:
        print('✓ 版本号一致')
    else:
        print(f'✗ 版本号不一致: {version} vs {auto_version}')
except Exception as e:
    print(f'✗ auto_updater/version.txt 错误: {e}')
"
```

## 常见问题

### Q: 修改配置后不生效？
A: 重启应用程序，确保配置文件被重新加载。

### Q: 版本号不一致怎么办？
A: 使用 `python update_version.py --verify` 检查并修复。

### Q: GitHub连接失败？
A: 检查updater_config.json中的仓库配置是否正确。

---

**文档版本**：1.0
**最后更新**：2025-10-27