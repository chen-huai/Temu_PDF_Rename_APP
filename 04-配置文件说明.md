# 配置文件说明

## 概述

项目采用**Python常量配置系统**，所有配置信息直接嵌入到代码中，消除外部文件依赖，提高安全性和部署便利性。

## 🔄 配置系统架构变更

### ✨ 新架构特点（v2.0.0+）

- **Python常量配置**：所有配置信息存储在`auto_updater/config_constants.py`中
- **零外部依赖**：打包后的exe文件无需任何外部配置文件
- **类型安全**：支持IDE自动补全和类型检查
- **用户不可修改**：确保核心配置的安全性

### ❌ 旧架构问题（v2.0.0之前）

- **JSON配置文件**：需要外部文件支持，容易丢失或被修改
- **部署复杂性**：需要确保配置文件与exe在同一目录
- **安全风险**：用户可能误修改关键配置

## 📁 配置文件结构

### 1. config_constants.py（核心配置文件）

**位置**：`auto_updater/config_constants.py`

**用途**：应用程序的核心配置常量，包含所有应用信息、仓库配置、版本管理等。

**主要内容**：
```python
# 应用配置
APP_NAME: str = "PDF重命名工具"
APP_EXECUTABLE: str = "PDF_Rename_Operation.exe"

# GitHub仓库配置
GITHUB_OWNER: str = "chen-huai"
GITHUB_REPO: str = "Temu_PDF_Rename_APP"
GITHUB_API_BASE: str = "https://api.github.com"

# 版本配置
CURRENT_VERSION: str = "2.0.1"
UPDATE_CHECK_INTERVAL_DAYS: int = 30
AUTO_CHECK_ENABLED: bool = True

# 更新配置
MAX_BACKUP_COUNT: int = 3
DOWNLOAD_TIMEOUT: int = 300
MAX_RETRIES: int = 3
AUTO_RESTART: bool = True

# 网络配置
REQUEST_HEADERS: dict = {
    "Accept": "application/vnd.github.v3+json",
    "User-Agent": "PDF-Rename-Tool-Updater/1.0"
}
```

**关键优势**：
- **编译时嵌入**：配置信息直接编译到exe文件中
- **类型安全**：Python类型提示确保配置正确性
- **IDE支持**：自动补全和错误检查
- **用户不可修改**：提高应用安全性

### 2. config.py（配置管理类）

**位置**：`auto_updater/config.py`

**用途**：提供配置管理的高级接口，支持配置验证、版本比较等功能。

**主要功能**：
```python
from auto_updater.config import get_config

# 获取配置实例
config = get_config()

# 获取配置信息
version = config.current_version
repo = config.github_repo

# 版本比较
result = config.compare_versions("2.0.1", "2.0.0")

# 检查是否需要更新
should_update = config.is_newer_version("2.0.1", "2.0.0")
```

## 🔧 配置修改方法

### ⚠️ 重要提示

由于采用Python常量配置系统，**普通用户无法修改配置**。如需修改配置，需要：

1. **开发者修改**：修改`config_constants.py`中的常量值
2. **重新打包**：运行`python 打包工具.py`生成新的exe文件
3. **重新签名**：对新exe文件进行数字签名（如需要）

### 📝 配置修改步骤（开发者）

1. **打开配置文件**：
   ```bash
   # 编辑配置常量文件
   notepad auto_updater/config_constants.py
   ```

2. **修改配置值**：
   ```python
   # 示例：修改版本号
   CURRENT_VERSION: str = "2.0.2"

   # 示例：修改GitHub仓库
   GITHUB_OWNER: str = "new-owner"
   GITHUB_REPO: str = "new-repo"

   # 示例：修改更新检查间隔
   UPDATE_CHECK_INTERVAL_DAYS: int = 7
   ```

3. **验证配置**：
   ```python
   from auto_updater.config_constants import validate_config

   if validate_config():
       print("✅ 配置验证通过")
   else:
       print("❌ 配置验证失败")
   ```

4. **重新打包**：
   ```bash
   python 打包工具.py
   ```

## 📋 配置参数详解

### 🏷️ 应用标识配置

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `APP_NAME` | str | "PDF重命名工具" | 应用程序名称 |
| `APP_EXECUTABLE` | str | "PDF_Rename_Operation.exe" | 可执行文件名 |

### 🌐 GitHub仓库配置

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `GITHUB_OWNER` | str | "chen-huai" | GitHub仓库所有者 |
| `GITHUB_REPO` | str | "Temu_PDF_Rename_APP" | GitHub仓库名称 |
| `GITHUB_API_BASE` | str | "https://api.github.com" | GitHub API基础URL |

### 🔢 版本管理配置

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `CURRENT_VERSION` | str | "2.0.1" | 当前版本号 |
| `UPDATE_CHECK_INTERVAL_DAYS` | int | 30 | 更新检查间隔（天） |
| `AUTO_CHECK_ENABLED` | bool | True | 是否启用自动检查 |

### ⚙️ 更新行为配置

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `MAX_BACKUP_COUNT` | int | 3 | 最大备份文件数量 |
| `DOWNLOAD_TIMEOUT` | int | 300 | 下载超时时间（秒） |
| `MAX_RETRIES` | int | 3 | 最大重试次数 |
| `AUTO_RESTART` | bool | True | 更新后是否自动重启 |

### 🌐 网络请求配置

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `REQUEST_HEADERS` | dict | 见上方 | HTTP请求头配置 |

## 🚨 配置验证

### 自动验证功能

系统提供自动配置验证功能，确保配置信息的完整性和正确性：

```python
from auto_updater.config_constants import validate_config

# 运行配置验证
if validate_config():
    print("✅ 所有配置验证通过")
else:
    print("❌ 配置验证失败")
    print("请检查config_constants.py中的配置信息")
```

### 验证内容

- ✅ 必要常量存在性检查
- ✅ 版本号格式验证
- ✅ URL格式正确性验证
- ✅ 配置类型匹配检查

## 📊 配置历史和变更

### v2.0.0+：Python常量配置系统

- **2025-10-28**：完成配置文件Python化改造
- **变更内容**：
  - 新增`config_constants.py`作为配置数据源
  - 修改`config.py`使用Python常量
  - 移除所有JSON配置文件依赖
  - 简化打包工具，无需处理外部配置文件

### v1.x.x：JSON配置系统

- 使用`updater_config.json`作为主配置文件
- 需要外部文件支持
- 用户可以修改配置文件

## 🔍 故障排除

### 常见问题

**Q: 如何确认当前使用的配置？**
```python
from auto_updater.config import get_config
config = get_config()
print(f"当前版本: {config.current_version}")
print(f"GitHub仓库: {config.github_repo}")
```

**Q: 配置修改后不生效？**
- 确认已修改`config_constants.py`
- 重新运行打包工具生成新的exe文件
- 使用新的exe文件替换旧文件

**Q: 配置验证失败？**
- 检查`config_constants.py`中的常量定义
- 确认所有必要的常量都已定义
- 检查版本号格式是否正确

**Q: 版本号格式错误？**
版本号应遵循语义化版本格式：`主版本.次版本.修订版本`（如：2.0.1）

## 📚 相关文档

- [05-自动更新功能使用教程.md](./05-自动更新功能使用教程.md) - 自动更新配置和使用
- [07-版本更新清单.md](./07-版本更新清单.md) - 版本发布记录和变更历史
- [CLAUDE.md](./CLAUDE.md) - 项目架构和技术文档

---

*配置文件说明版本：2.0 | 最后更新：2025-10-28 | 适用版本：v2.0.0+*